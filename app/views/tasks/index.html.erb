<h1><%= I18n.t("display.index") %></h1>
<%= form_with(model: @task, url: tasks_path, method: :get, local: true) do |form| %>
  <%= form.label :title %>
  <%= form.text_field :title , value: @where[:title] %>
  <%= form.label :status %>
  <%= form.select(:status, options_for_select(TasksHelper::LIMIT_TASK_STATUS, @where[:status]),include_blank:true) %>
  <%= form.label :priority %>
  <%= form.select(:priority, options_for_select(TasksHelper::PRIORITY_STATUS, @where[:priority]),include_blank:true) %>
  <br>
  <% @labels.each do |label| %>
    <%= form.check_box :label_ids, {multiple: true, checked: @where[:label_ids].include?(label.id.to_s), include_hidden: false}, label[:id] %>
    <label><%= label.name %></label>
    <% end %>
  <br>
  <%= form.submit(I18n.t("button.search"),{ class: "btn btn-info" } ) %>
  <br>
  <br>
  <%= link_to I18n.t("button.create"), new_task_path,{ class: "btn btn-primary pull-left" } %>
<% end %> 
<br>
<table class="table table-bordered table-striped">
  <thead>
    <tr>
      <th><%= I18n.t("activerecord.attributes.task.title") %></th>
      <th><%= I18n.t("activerecord.attributes.task.user_id") %></th>
      <th><%= I18n.t("activerecord.attributes.task.content") %></th>
      <th><%= I18n.t("activerecord.attributes.task.status") %></th>
      <th>
        <%= I18n.t("display.limit") %>
        <%= link_to "▲", tasks_path(column: "limit", sort: "ASC", title: @where[:title], status: @where[:status], priority: @where[:priority], label_ids: @where[:label_ids]), { id: "limit_asc" } %>
        <%= link_to "▼", tasks_path(column: "limit", sort: "DESC", title: @where[:title], status: @where[:status], priority: @where[:priority], label_ids: @where[:label_ids]), { id: "limit_desc" } %>
      </th>
      <th>
        <%= I18n.t("display.priority") %>
        <%= link_to "▲", tasks_path(column: "priority", sort: "DESC", title: @where[:title], status: @where[:status], priority: @where[:priority], label_ids: @where[:label_ids]), {id: "priority_desc"}  %>
        <%= link_to "▼", tasks_path(column: "priority", sort: "ASC", title: @where[:title], status: @where[:status], priority: @where[:priority], label_ids: @where[:label_ids]), {id: "priority_asc"}  %><br>
      </th>
      <th><%=  I18n.t("activerecord.models.label") %></th>
      <th><%=  I18n.t("activerecord.attributes.task.created_at") %></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @tasks.each do |task| %>
      <tr>
        <td class="test_title">
          <%= link_to task.title, task_path(task.id) %>
        </td>
        <td><%= task.user.name %></td>
        <td><%= task.content %></td>
        <td><%= view_task_status(task.status) %></td>
        <td><%= format_date(task.limit) %></td>
        <td><%= view_priority_status(task.priority) %></td>
        <td>
          <% task.labels.each do |label| %>
          <%= label.name %><br>
          <% end %>
        </td>
        <td><%= format_date(task.created_at) %></td>
        <td><%= link_to I18n.t("button.update"), edit_task_path(task.id) ,id: "edit_#{task.id}", class: "btn btn-primary pull-left" %></td>
        <td><%= link_to I18n.t("button.delete"), task_path(task.id) ,method: :delete ,id: "delete_#{task.id}", class: "btn btn-danger pull-left"%></td>
      </tr>
    <% end %>
  </tbody>
</table>
<%= paginate @tasks, left: 2, right: 2 %>